from typing import List
import requests
import string
import random
import csv

columns_to_include = [
'StudentID', 
    'OldStudentID',
    'CorrespondenceLanguageCode',
    'CounselorNumber',
    'StudentPersonalEmailAddress',
    'SchoolCode',
    'StudentNumber',
    'StateStudentID',
    'LastName',
    'FirstName',
    'MiddleName',
    'Gender',
    'Grade',
    'GradeLevelShortDescription',
    'GradeLevelLongDescription',
    'Birthdate',
    'ParentGuardianName',
    'HomePhone',
    'StudentMobilePhone',
    'MailingAddress',
    'MailingAddressCity',
    'MailingAddressState',
    'MailingAddressZipCode',
    'ResidenceAddress',
    'ResidenceAddressCity',
    'ResidenceAddressState',
    'ResidenceAddressZipCode',
    'AddressVerified',
    'EthnicityCode',
    'RaceCode1',
    'SchoolEnterDate',
    'SchoolLeaveDate',
    'DistrictEnterDate',
    'AttendanceProgramCodePrimary',
    'LockerNumber',
    'LowSchedulingPeriod',
    'HighSchedulingPeriod',
    'FamilyKey',
    'LanguageFluencyCode',
    'HomeLanguageCode',
    'ParentEdLevelCode',
    'ParentEmailAddress',
    'StudentEmailAddress',
    'NetworkLoginID',
    'EarlyWarningPoints',
    'HomeRoomTeacherNumber',
    'NotificationPreferenceCode',
    'NextSchoolCode',
    'NextGrade',
    'NextGradeLevelShortDescription',
    'NextGradeLevelLongDescription'
]

def get_current_grades(
    aeries_base_url: str,
    aeries_api_token: str,
    school_code: str,
    student_ids: str,
 
) -> str:
  api_base = f"{aeries_base_url}/api/v5/schools/{school_code}/students"
  #api_base = f'/Admin/api/v5/schools/{schoolcode}/enrollment/{StudentID}/year/{AcademicYear}'
  request_headers = {"formatType":"text/json", "AERIES-CERT": aeries_api_token}
  # random letters
  ran_string = ''.join(random.choice(string.ascii_letters) for i in range(10))
  file_path = f'Student_Enrollment_{ran_string}.csv'

  with open(file_path, 'w', newline='') as Student_Enrollment_csv_file:
    csv_writer = csv.writer(Student_Enrollment_csv_file)
    csv_writer.writerow(columns_to_include) # header row in the csv
   
 
    api_url = f"{api_base}/{student_ids}"
    request_json = requests.get(api_url, headers = request_headers).json()
    print(request_json)
    for data in request_json:
      filteredData = dict((k, data[k]) for k in columns_to_include if k in data)
      csv_writer.writerow(filteredData.values())
       

  
  return file_path
get_current_grades('https://demo.aeries.net/aeries/','477abe9e7d27439681d62f4e0de1f5e1','994','99400002')
